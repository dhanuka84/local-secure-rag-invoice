<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36" version="29.0.3">
  <diagram id="hybridFlow" name="Hybrid Architecture + Flow">
    <mxGraphModel dx="1598" dy="518" grid="1" gridSize="10" guides="0" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0" adaptiveColors="none">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="n1" value="1. extract_pdf" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;" parent="1" vertex="1">
          <mxGeometry x="40" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n2" value="2. ocr_if_needed" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;" parent="1" vertex="1">
          <mxGeometry x="40" y="60" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n3" value="3. signature" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;" parent="1" vertex="1">
          <mxGeometry x="40" y="120" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n4" value="4. check_cache" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;" parent="1" vertex="1">
          <mxGeometry x="40" y="180" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n5" value="5. should_reuse_or_search" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="17.5" y="250" width="195" height="90" as="geometry" />
        </mxCell>
        <mxCell id="n6a" value="6a. milvus_suggest" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;" parent="1" vertex="1">
          <mxGeometry x="380" y="180" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="n7" value="7. should_use_suggest_or_learn" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="240" y="270" width="195" height="110" as="geometry" />
        </mxCell>
        <mxCell id="n6b" value="6b. extract_using_suggested_template" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;" parent="1" vertex="1">
          <mxGeometry x="290" y="480" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n8a" value="8a. learn_and_stage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;" parent="1" vertex="1">
          <mxGeometry x="500" y="260" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n8b" value="8b. extract_using_learned_template" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;" parent="1" vertex="1">
          <mxGeometry x="500" y="390" width="210" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n9" value="9. extract_fields" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;" parent="1" vertex="1">
          <mxGeometry x="40" y="390" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n10" value="10. vision_validate" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;" parent="1" vertex="1">
          <mxGeometry x="40" y="450" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n11" value="11. should_pass_or_review" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="35" y="510" width="165" height="90" as="geometry" />
        </mxCell>
        <mxCell id="n12a" value="12a. promote_template" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;" parent="1" vertex="1">
          <mxGeometry x="255" y="580" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n12b" value="12b. mark_for_review" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;" parent="1" vertex="1">
          <mxGeometry x="-200" y="600" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n13" value="13. done" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;" parent="1" vertex="1">
          <mxGeometry x="42.5" y="650" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n14" value="14. END" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;" parent="1" vertex="1">
          <mxGeometry x="42.5" y="710" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="a1" value="LangGraph Orchestrator" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cce5ff;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="590" y="20" width="190" height="60" as="geometry" />
        </mxCell>
        <mxCell id="a2" value="Invoice Toolkit&#xa;(pdf_io, extract, signature)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3f2fd;" parent="1" vertex="1">
          <mxGeometry x="310" y="15" width="210" height="70" as="geometry" />
        </mxCell>
        <mxCell id="a3" value="Redis&#xa;cache + metrics + checkpoints" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fdecea;" parent="1" vertex="1">
          <mxGeometry x="730" y="120" width="210" height="70" as="geometry" />
        </mxCell>
        <mxCell id="a5" value="Cerbos&#xa;policy engine" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;" parent="1" vertex="1">
          <mxGeometry x="890" y="230" width="210" height="70" as="geometry" />
        </mxCell>
        <mxCell id="a6" value="Ollama / Vision Model&#xa;self-evaluation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;" parent="1" vertex="1">
          <mxGeometry x="710" y="470" width="210" height="70" as="geometry" />
        </mxCell>
        <mxCell id="a7" value="JSON Output&#xa;final invoice state" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="380" y="630" width="210" height="70" as="geometry" />
        </mxCell>
        <mxCell id="e1" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;" parent="1" source="n1" target="n2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e2" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;" parent="1" source="n2" target="n3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e3" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;" parent="1" source="n3" target="n4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e4" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;" parent="1" source="n4" target="n5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e5" value="reuse" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;" parent="1" source="n5" target="n9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e6" value="search" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;entryX=0;entryY=0.75;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="n5" target="n6a" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="230" y="295" />
              <mxPoint x="230" y="218" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e7" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;" parent="1" source="n6a" target="n7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e8" value="use_suggest" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;" parent="1" source="n7" target="n6b" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e9" value="learn" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;" parent="1" source="n7" target="n8a" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e10" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;" parent="1" source="n8a" target="n8b" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e11" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;entryX=1;entryY=1;entryDx=0;entryDy=0;" parent="1" source="n6b" target="n9" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="240" y="500" />
              <mxPoint x="240" y="430" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e12" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;" parent="1" source="n8b" target="n9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e13" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;" parent="1" source="n9" target="n10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e14" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;" parent="1" source="n10" target="n11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e15" value="pass" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="n11" target="n12a" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e16" value="review" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;entryX=0.75;entryY=0;entryDx=0;entryDy=0;" parent="1" source="n11" target="n12b" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e17" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;" parent="1" source="n12a" target="n13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="160" y="600" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e18" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;" parent="1" source="n12b" target="n13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e19" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;" parent="1" source="n13" target="n14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ea1" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;dashed=1;" parent="1" source="a1" target="a2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ea2" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;dashed=1;" parent="1" source="a1" target="a3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ea3" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;dashed=1;" parent="1" source="a1" target="a4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ea4" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;dashed=1;" parent="1" source="a1" target="a5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ea5" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;dashed=1;" parent="1" source="a4" target="a6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ea6" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;dashed=1;" parent="1" source="n14" target="a7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="UIZ637wB1I7sEpwpBNPo-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;dashed=1;" edge="1" parent="1" source="a1" target="a4">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="685" y="80" as="sourcePoint" />
            <mxPoint x="885" y="510" as="targetPoint" />
            <Array as="points">
              <mxPoint x="685" y="260" />
              <mxPoint x="815" y="260" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="a4" value="Milvus&#xa;vector DB for signatures" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;" parent="1" vertex="1">
          <mxGeometry x="740" y="350" width="210" height="70" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
